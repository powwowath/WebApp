<!DOCTYPE html>
<html>

<head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>BDMA 2016 - 2017</title>

    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="font-awesome/css/font-awesome.css" rel="stylesheet">

    <link href="css/animate.css" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet">

    <link href="css/plugins/select2/select2.min.css" rel="stylesheet">
	<link href="css/plugins/chosen/bootstrap-chosen.css" rel="stylesheet">


</head>

<body>
<!-- URL:  www.example.com/correct/?message=done&year=1990 -->

	<script src="js/jquery-3.1.1.min.js"></script>
	<script src="js/bootstrap.min.js"></script>

<!-- Select2 -->
<script src="js/plugins/select2/select2.full.min.js"></script>



<div id="wrapper">

    <nav class="navbar-default navbar-static-side" role="navigation">
        <div class="sidebar-collapse">
            <ul class="nav metismenu" id="side-menu">
                <li class="nav-header">
                    <div class="dropdown profile-element">
                            <a data-toggle="dropdown" class="dropdown-toggle" href="#">
                            <span class="clear"> <span class="block m-t-xs"> <strong class="font-bold"><big><big>BDMA</big></big></strong>
							</span> <!--span class="text-muted text-xs block">Art Director <b class="caret"></b></span> </span--> </span></a>
                            <ul class="dropdown-menu animated fadeInRight m-t-xs">
                                <li><a href="#">Logout</a></li>
                            </ul>
                    </div>
                    <div class="logo-element">
                        IN+
                    </div>
                </li>
                <li class="active">
                    <a href="#"><i class="fa fa-plane"></i> <span class="nav-label">Search routes</span></a>
                </li>
                <li>
                    <a href="#" id="cpanel"><i class="fa fa-lock"></i> <span class="nav-label">Control panel</span> </a>
                </li>
            </ul>

        </div>
    </nav>

    <div id="page-wrapper" class="gray-bg">
        <div class="row border-bottom">
            <nav class="navbar navbar-static-top white-bg" role="navigation" style="margin-bottom: 0">
                <div class="navbar-header">
                    <a class="navbar-minimalize minimalize-styl-2 btn btn-primary " href="#"><i class="fa fa-bars"></i> </a>
                </div>
                <ul class="nav navbar-top-links navbar-right">
					<li>
						<span class="m-r-sm text-muted welcome-message" id="username"></span>
					</li>
					<li>
                        <a href="start.html">
                            <i class="fa fa-sign-out"></i> Log out
                        </a>
                    </li>
                </ul>

            </nav>
        </div>
        <div class="wrapper wrapper-content animated fadeInRight">
			<div class="row">
				<div class="col-lg-6">
					<div class="ibox float-e-margins">
						<div class="ibox-title">
							<h5>Search routes</h5>
							<div class="ibox-tools">
								<a class="collapse-link">
									<i class="fa fa-chevron-up"></i>
								</a>
								<a class="close-link">
									<i class="fa fa-times"></i>
								</a>
							</div>
						</div>
						<div class="ibox-content">
							<form id="searchForm" class="form-horizontal">

								<label class="font-normal"><b>Departure</b></label>
								<div>
									<select id="city" name="city" data-placeholder="Choose a city..." class="chosen-select"  tabindex="2">
										<option value="">Select a city</option>
									</select>
									&#160;&#160;<input id="round" type="checkbox" value="" checked="1"> Round trip</label>
								</div>
								<br/><br/>

								<label class="font-normal"><b>Number of steps</b></label>
								<div>
									<select id="steps" name="steps" data-placeholder="Number of steps..." class="chosen-select col-md-2"  tabindex="2">
										<option value="1">1</option>
										<option value="2">2</option>
										<option value="3">3</option>
										<option value="4">4</option>
									</select>
								</div>
								<br/><br/>

								<!--label class="font-normal"><b>Region</b></label>
								<div>
									<select id="region" name="region" data-placeholder="Region" class="chosen-select col-md-2"  tabindex="2">
										<option value="">Worldwide</option>
										<option value="Africa">Africa</option>
										<option value="America">America</option>
										<option value="Arctic">Arctic</option>
										<option value="Asia">Asia</option>
										<option value="Atlantic">Atlantic</option>
										<option value="Australia">Australia</option>
										<option value="Europe">Europe</option>
										<option value="Pacific">Pacific</option>
										<option value="Indian">Indian</option>
									</select>
								</div>
								<br/><br/-->

								<p><b>Interests (max 2)</b></p>
								<div class="checkbox checkbox-inline">
									&#160;&#160;&#160;&#160;<input type="checkbox" id="checkCulture" value="clt">Cultural
								</div>
								<div class="checkbox checkbox-success checkbox-inline">
									&#160;&#160;&#160;&#160;<input type="checkbox" id="checkNight" value="nig">Nightlife
								</div>
								<div class="checkbox checkbox-success checkbox-inline">
									&#160;&#160;&#160;&#160;<input type="checkbox" id="checkBeach" value="bea">Beach
								</div>
								<div class="checkbox checkbox-inline">
									&#160;&#160;&#160;&#160;<input type="checkbox" id="checkMountain" value="mou">Mountain
								</div>
								<div class="checkbox checkbox-success checkbox-inline">
									&#160;&#160;&#160;&#160;<input type="checkbox" id="checkTurist" value="tou">Tourist city
								</div>
								<br/><br/>

								<p><b>Type of destination</b></p>
								<div class="checkbox checkbox-inline">
									&#160;&#160;&#160;&#160;<input type="checkbox" id="bigCities" value="true">Only Big cities
								</div>
								<div class="checkbox checkbox-inline">
									&#160;&#160;&#160;&#160;<input type="checkbox" id="smallCities" value="true">Only Small cities
								</div>
								<br/><br/>

								<label class="font-normal"><b>Max distance (in KM)</b></label>
								<div>
									<select id="distance" name="distance" data-placeholder="Max distance (in KM)" class="chosen-select col-md-2"  tabindex="2">
										<option value="S">Short (&lt; 2.000)</option>
										<option value="M">Medium (2.000 - 5.000)</option>
										<option value="L">Large (5.000 - 15.000)</option>
										<option value="W">Willy Fog (&gt; 15.000)</option>
									</select>
								</div>
								<br/><br/>

								<div class="form-group">
									<div class="col-lg-10">
										<button class="btn btn-sm btn-white" type="submit">Search</button>
									</div>
								</div>
							</form>
						</div>
					</div>
				</div>

				<!--
				 You need to include this script on any page that has a Google Map.
				 When using Google Maps on your own site you MUST signup for your own API key at:
				 https://developers.google.com/maps/documentation/javascript/tutorial#api_key
				 After your sign up replace the key in the URL below..
				-->
				<script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyA8Nf5_AhALJ6kGWsoPdDVchMOF9tR0KGc"></script>



				<div class="col-md-6">
					<div class="col-md-12" id="route1">
						<div class="ibox">
							<div class="ibox-content product-box">
								<div class="product-desc">
									<small class="text-muted"></small>
									<a href="#" class="product-name" id="routeName1"></a>

									<div class="small m-t-xs">
										<b>Steps:</b> <span id="nSteps1"></span><br/>
										<b>Distance:</b> <span id="nDistance1"></span> km
									</div>
									<div class="m-t text-righ">
										<a class="btn btn-danger btn-xs likeBtn" id="like1"><i class="fa fa-heart"></i>&#160;Like</a>
										<br/>&#160;
									</div>
									<div id="map_d1" style="width:100%; height:250px"></div>
								</div>
							</div>
						</div>
					</div>
					<div class="col-md-12" id="route2">
						<div class="ibox">
							<div class="ibox-content product-box">
								<div class="product-desc">
									<small class="text-muted"></small>
									<a href="#" class="product-name" id="routeName2"></a>

									<div class="small m-t-xs">
										<b>Steps:</b> <span id="nSteps2"></span><br/>
										<b>Distance:</b> <span id="nDistance2"></span> km
									</div>
									<div class="m-t text-righ">
										<a class="btn btn-danger btn-xs likeBtn" id="like2"><i class="fa fa-heart"></i>&#160;Like</a>					<br/>&#160;
									</div>
									<div id="map_d2" style="width:100%; height:250px"></div>
								</div>
							</div>
						</div>
					</div>
					<div class="col-md-12" id="route3">
						<div class="ibox">
							<div class="ibox-content product-box">
								<div class="product-desc">
									<small class="text-muted"></small>
									<a href="#" class="product-name" id="routeName3"></a>

									<div class="small m-t-xs">
										<b>Steps:</b> <span id="nSteps3"></span><br/>
										<b>Distance:</b> <span id="nDistance3"></span> km
									</div>
									<div class="m-t text-righ">
										<a class="btn btn-danger btn-xs likeBtn" id="like3"><i class="fa fa-heart"></i>&#160;Like</a>
										<br/>&#160;
									</div>
									<div id="map_d3" style="width:100%; height:250px"></div>
								</div>
							</div>
						</div>
					</div>
					<div class="col-md-12" id="route4">
						<div class="ibox">
							<div class="ibox-content product-box">
								<div class="product-desc">
									<small class="text-muted"></small>
									<a href="#" class="product-name" id="routeName4"></a>

									<div class="small m-t-xs">
										<b>Steps:</b> <span id="nSteps4"></span><br/>
										<b>Distance:</b> <span id="nDistance4"></span> km
									</div>
									<div class="m-t text-righ">
										<a class="btn btn-danger btn-xs likeBtn" id="like4"><i class="fa fa-heart"></i>&#160;Like</a>
										<br/>&#160;
									</div>
									<div id="map_d4" style="width:100%; height:250px"></div>
								</div>
							</div>
						</div>
					</div>
					<div class="col-md-12" id="route5">
						<div class="ibox">
							<div class="ibox-content product-box">
								<div class="product-desc">
									<small class="text-muted"></small>
									<a href="#" class="product-name" id="routeName5"></a>

									<div class="small m-t-xs">
										<b>Steps:</b> <span id="nSteps5"></span><br/>
										<b>Distance:</b> <span id="nDistance5"></span> km
									</div>
									<div class="m-t text-righ">
										<a class="btn btn-danger btn-xs likeBtn" id="like5"><i class="fa fa-heart"></i>&#160;Like</a>
										<br/>&#160;
									</div>
									<div id="map_d5" style="width:100%; height:250px"></div>
								</div>
							</div>
						</div>
					</div>
					<div class="col-md-12" id="route6">
						<div class="ibox">
							<div class="ibox-content product-box">
								<div class="product-desc">
									<small class="text-muted"></small>
									<a href="#" class="product-name" id="routeName6"></a>

									<div class="small m-t-xs">
										<b>Steps:</b> <span id="nSteps6"></span><br/>
										<b>Distance:</b> <span id="nDistance6"></span> km
									</div>
									<div class="m-t text-righ">
										<a class="btn btn-danger btn-xs likeBtn" id="like6"><i class="fa fa-heart"></i>&#160;Like</a>
										<br/>&#160;
									</div>
									<div id="map_d6" style="width:100%; height:250px"></div>
								</div>
							</div>
						</div>
					</div>
					<!--div class="col-md-12">
						<div class="ibox">
							<div class="ibox-content product-box">
								<div class="product-desc">
									<a class="btn btn-danger btn-xs" id="more">&#160;More</a>
								</div>
							</div>
						</div>
					</div-->
				</div>
			</div>


		<!-- Results -->
			<div class="row">

			</div>
		</div>






        <div class="footer">
            <div class="pull-right">
                Oscar Hortelano - Ricardo Oliveira - Gerard Font
            </div>
            <div>
                <strong>Copyright</strong> BDMA &copy; 2016-2017
            </div>
        </div>

    </div>
</div>

	<!-- Mainly scripts -->
	<script src="js/jquery-3.1.1.min.js"></script>
	<script src="js/bootstrap.min.js"></script>
	<script src="js/plugins/metisMenu/jquery.metisMenu.js"></script>
	<script src="js/plugins/slimscroll/jquery.slimscroll.min.js"></script>

	<!-- Custom and plugin javascript -->
	<script src="js/inspinia.js"></script>
	<script src="js/plugins/pace/pace.min.js"></script>
	<!-- Chosen -->
	<script src="js/plugins/chosen/chosen.jquery.js"></script>

			
	<script type="text/javascript">
		var routes;

		function zoomToObject(obj){
			var bounds = new google.maps.LatLngBounds();
			var points = obj.getPath().getArray();
			for (var n = 0; n < points.length ; n++){
				bounds.extend(points[n]);
			}
			return bounds;
		}


        $(document).ready(function(){
        	$("#route1").hide();
        	$("#route2").hide();
        	$("#route3").hide();
        	$("#route4").hide();
        	$("#route5").hide();
        	$("#route6").hide();

        	var urlParams = new URLSearchParams(window.location.search);
        	$("#username").html(urlParams.get('name'));

			if (urlParams.get('name') === null){
				window.location.href = "./start.html";
			}

			$('.chosen-select').chosen({width: "50%"});
			$("#steps").chosen({disable_search_threshold: 10});

			$( "#cpanel" ).click(function() {
				window.location.replace("cpanel.html?name="+urlParams.get('name'));
			});

			$( "#bigCities" ).click(function() {
				if( $("#bigCities").prop("checked") ) {
					$("#smallCities").prop('checked', false);
				}
			});
			$( "#smallCities" ).click(function() {
				if( $("#smallCities").prop('checked') ){
					$("#bigCities").prop('checked', false);
				}
			});

			// USPERT User -----------------------------------------------------------------------------
			$.ajax({
				headers: {
					'Accept': 'application/json',
					'Content-Type': 'application/json'
				},
				url: '/users',
				type: 'post',
				dataType: 'json',
				success: function (data) {
					//
				},
				data: JSON.stringify(urlParams.get('name'))
        	});


			// Inital city search -----------------------------------------------------------------------------
			$.get("/cities", function(data){
				$.each(data, function(i, item) {
					var o = new Option(data[i].name+"#"+data[i].country, data[i].name+"#"+data[i].country);
					$(o).html(data[i].name + " (" +data[i].country+ ")");
					$("#city").append(o);
				});
				$('#city').trigger("chosen:updated");
			});

			// maps
			var map = [];


			// Perform SEARCH -----------------------------------------------------------------------------
			$( "#searchForm" ).submit(function( event ) {
				var query = "/routecandidates?";
				query += "departureCity=" + $("#city").val().substr(0,$("#city").val().indexOf("#"));
				query += "&departureCountry=" + $("#city").val().substr($("#city").val().indexOf("#")+1);
				query += "&steps=" + $("#steps").val();

				query += "&isRound=" + $("#round").prop("checked");

				query += "&checkCulture=" + $("#checkCulture").prop("checked");
				query += "&checkNight=" + $("#checkNight").prop("checked");
				query += "&checkBeach=" + $("#checkBeach").prop("checked");
				query += "&checkMountain=" + $("#checkMountain").prop("checked");
				query += "&checkTurist=" + $("#checkTurist").prop("checked");

				query += "&bigCities=" + $("#bigCities").prop("checked");
				query += "&smallCities=" + $("#smallCities").prop("checked");

				query += "&distance=" + $("#distance").val();

				$(".likeBtn").show();

				$("#route1").hide();
				$("#route2").hide();
				$("#route3").hide();
				$("#route4").hide();
				$("#route5").hide();
				$("#route6").hide();
				$("#routeName1").html("");
				$("#routeName2").html("");
				$("#routeName3").html("");
				$("#routeName4").html("");
				$("#routeName5").html("");
				$("#routeName6").html("");

				$.get(query, function(data){
					routes = data;
					$.each(data, function(i, item) {
						$("#routeName"+(i+1)).html(data[i].name);
						$("#nSteps"+(i+1)).html(data[i].nStopOver);
						$("#nDistance"+(i+1)).html(Math.round(data[i].distance));
						$("#route"+(i+1)).show();

						var flightPlanCoordinates = [];
						for (var j=0; j<item.lat.length; j++){
							flightPlanCoordinates.push( new google.maps.LatLng(parseFloat(item.lat[j]), parseFloat(item.lon[j])) );
						}
						var flightPath = new google.maps.Polyline({
						  path: flightPlanCoordinates,
						  geodesic: true,
						  strokeColor: '#FF0000',
						  strokeOpacity: 1.0,
						  strokeWeight: 2
						});


						var mapOptions = {
							zoom: 2,
							center: new google.maps.LatLng(30.0509, -21.2),
							// Style for Google Maps
							styles: [{"featureType":"water","stylers":[{"saturation":43},{"lightness":-11},{"hue":"#0088ff"}]},{"featureType":"road","elementType":"geometry.fill","stylers":[{"hue":"#ff0000"},{"saturation":-100},{"lightness":99}]},{"featureType":"road","elementType":"geometry.stroke","stylers":[{"color":"#808080"},{"lightness":54}]},{"featureType":"landscape.man_made","elementType":"geometry.fill","stylers":[{"color":"#ece2d9"}]},{"featureType":"poi.park","elementType":"geometry.fill","stylers":[{"color":"#ccdca1"}]},{"featureType":"road","elementType":"labels.text.fill","stylers":[{"color":"#767676"}]},{"featureType":"road","elementType":"labels.text.stroke","stylers":[{"color":"#ffffff"}]},{"featureType":"poi","stylers":[{"visibility":"off"}]},{"featureType":"landscape.natural","elementType":"geometry.fill","stylers":[{"visibility":"on"},{"color":"#b8cb93"}]},{"featureType":"poi.park","stylers":[{"visibility":"on"}]},{"featureType":"poi.sports_complex","stylers":[{"visibility":"on"}]},{"featureType":"poi.medical","stylers":[{"visibility":"on"}]},{"featureType":"poi.business","stylers":[{"visibility":"simplified"}]}]
						};
						map[i] = new google.maps.Map(document.getElementById("map_d"+(i+1)), mapOptions);

						flightPath.setMap(map[i]);
						map[i].fitBounds(zoomToObject(flightPath));

					});
				});

				event.preventDefault();
			});

			$( ".likeBtn" ).click(function() {
				var routeNum = $(this)[0].id.substring(4,5);
				delete routes[routeNum-1]["id"];
				delete routes[routeNum-1]["steps"];
/*
				delete routes[routeNum-1]["lon"];
				delete routes[routeNum-1]["lat"];
*/
				delete routes[routeNum-1]["users"];

				// Hide like button
				$(this).hide();
				var routeString = JSON.stringify(routes[routeNum-1]);
				var object = {
					userName : $("#username").html(),
					route : {
						name : routes[routeNum-1].name,
						nStopOver : routes[routeNum-1].nStopOver,
						distance : routes[routeNum-1].distance,
						departure : routes[routeNum-1].departure,
						departureCountry : routes[routeNum-1].departureCountry,
						indBeach : routes[routeNum-1].indBeach,
						indNightlife : routes[routeNum-1].indNightlife,
						indCulture : routes[routeNum-1].indCulture,
						indMountain : routes[routeNum-1].indMountain,
						indTourist : routes[routeNum-1].indTourist,
						bigCities : routes[routeNum-1].bigCities,
						smallCities : routes[routeNum-1].smallCities,
						lat : routes[routeNum-1].lat,
						lon : routes[routeNum-1].lon,
						round : routes[routeNum-1].round
					}
				}
				$.ajax({
					headers: {
						'Accept': 'application/json',
						'Content-Type': 'application/json'
					},
					url: '/routes',
					type: 'post',
					dataType: 'json',
					success: function (data) {
					},
					data: JSON.stringify(object)
				});

			});

		});
	</script>
</body>

</html>

